## 并行与同步

1.基于进程

*  难以共享资源，但同时也避免了可能带来的共享问题
*  添加/移除进程开销较大

基于事件

*  非常底层的实现机制
*  使用全局控制而非调度
*  开销比较小
*  但是无法提供精细度较高的并行
*  无法充分利用多核处理器

基于线程

*  容易共享资源，但也容易出现问题
*  开销比进程小
*  对于具体的调度可控性较低
*  难以调试（因为事件发生的顺序不一致）

2.具体的同步模型为：

*  生产者等待空的 slot，把 item 存储到 buffer，并通知消费者
*  消费整等待 item，从 buffer 中移除 item，并通知生产者
 
主要用于

*  多媒体处理
*  生产者生成 MPEG 视频帧，消费者进行渲染
*  事件驱动的图形用户界面
*  生产者检测到鼠标点击、移动和键盘输入，并把对应的事件插入到 buffer 中，消费者从 buffer 中获取事件，并绘制到到屏幕上

3.是互斥问题的通用描述，具体为：

*  读者线程只读取对象
*  写者线程修改对象
*  写者对于对象的访问是互斥的
*  多个读者可以同时读取对象

常见的应用场景是：

*  在线订票系统
*  多线程缓存 web 代理

4.主要有 4 类线程不安全的函数

* 不保护共享变量的函数
	* 解决办法：使用 P 和 V semaphore 操作
   *  问题：同步操作会影响性能

* 在多次调用间保存状态的函数
  * 解决办法：把状态当做传入参数

* 返回指向静态变量的指针的函数
  * 解决办法1：重写函数，传地址用以保存
  * 解决办法2：上锁，并且进行复制

* 调用线程不安全函数的函数
  * 解决办法：只调用线程安全的函数

5.总结来看，并行编程需要注意的是：

*  要有并行策略，可以把一个大任务分成若干个独立的子任务，或者用分而治之的方式来解决
* 内循环最好不要有任何同步机制
* 注意 Amdahl’s Law
* 一致性是个大问题，无论是计算一致性还是存储一致性，都需要仔细考虑